<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Silent Renew</title>
</head>
<body>
  <p>Completing silent renew...</p>
  <script src="https://unpkg.com/oidc-client@1.11.5/dist/oidc-client.min.js"></script>
  <script>
    (async () => {
      try {
        // Fetch metadata from backend proxy
        const resp = await fetch('http://localhost:4000/auth/.well-known/openid-configuration')
        const metadata = await resp.json()
        const cfg = {
          metadata,
          authority: metadata.issuer,
          client_id: '6X50o3_1KNfaZHOibbo1w2Xe9oca',
          redirect_uri: 'http://localhost:5173',
          post_logout_redirect_uri: 'http://localhost:5173',
          response_type: 'code',
          scope: 'openid profile email',
          silent_redirect_uri: 'http://localhost:5173/silent-renew.html',
          userStore: new Oidc.WebStorageStateStore({ store: window.localStorage })
        }
        const mgr = new Oidc.UserManager(cfg)
        await mgr.signinSilentCallback()
      } catch (e) {
        console.error('Silent renew callback error', e)
      }
    })()
  </script>
</body>
</html>
